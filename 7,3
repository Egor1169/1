<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Браузер Баз Данных</title>
<style>
body {
    font-family: Arial, sans-serif;
    margin: 20px;
}
h1 {
    color: #4CAF50;
}
table {
    width: 100%;
    border-collapse: collapse;
}
table, th, td {
    border: 1px solid #dddddd;
    padding: 8px;
}
th {
    background-color: #f2f2f2;
}
a {
    color: #337ab7;
    text-decoration: none;
}
a:hover {
    text-decoration: underline;
}
.error {
    color: red;
    font-style: italic;
}
.popular-chars {
    margin-top: 20px;
    margin-bottom: 20px;
}

.popular-chars ul {
    list-style: disc;
    padding-left: 20px;
}
</style>
</head>
<body>

<h1>Браузер Баз Данных</h1>

<?php
// Конфигурация базы данных (замените на ваши данные)
$host = 'localhost';
$user = 'your_username';
$password = 'your_password';

// Соединение с сервером MySQL
$conn = new mysqli($host, $user, $password);

// Проверка соединения
if ($conn->connect_error) {
    die("<div class='error'>Ошибка подключения: " . $conn->connect_error . "</div>");
}

function displayPopularChars($conn, $table) {
    $popularChars = [];
    $sql = "SHOW COLUMNS FROM $table";
    $resultColumns = $conn->query($sql);
    if (!$resultColumns) {
        echo "<li class='error'>Ошибка получения столбцов для таблицы $table: " . $conn->error . "</li>";
        return;
    }

    while ($column = $resultColumns->fetch_assoc()) {
        $columnName = $column['Field'];
        $sql = "SELECT SUBSTRING(?, 1, 1) AS first_char FROM `$table` WHERE LENGTH(?) > 0 GROUP BY first_char ORDER BY COUNT(*) DESC LIMIT 1";
        $stmt = $conn->prepare($sql);

        $stmt->bind_param("ss", $columnName, $columnName);
        $stmt->execute();
        $result = $stmt->get_result();

        if ($result->num_rows > 0) {
            $row = $result->fetch_assoc();
            $popularChars[$columnName] = $row['first_char'];
        } else {
            $popularChars[$columnName] = '<i>Не найдено символов</i>';
        }

        $stmt->close();
    }
    $resultColumns->close();

	echo "<ul>";
    foreach ($popularChars as $column => $char) {
        echo "<li><b>$column:</b> " . htmlspecialchars($char) . "</li>";
    }
    echo "</ul>";
}

function displayPopularCharsForAllTables($conn, $db) {
    $conn->select_db($db);

    echo "<div class='popular-chars'>";
    echo "<h2>Популярные символы во всех таблицах базы данных: $db</h2>";

    $tablesResult = $conn->query("SHOW TABLES");
    if (!$tablesResult) {
        echo "<li class='error'>Ошибка при получении списка таблиц: " . $conn->error . "</li>";
        return;
    }

    while ($table = $tablesResult->fetch_row()) {
        $tableName = $table[0];

      try {
          displayPopularChars($conn, $tableName);
      } catch(mysqli_sql_exception $e) {
        echo "<li class='error'>Ошибка при выводе популярных символов для таблицы $tableName: " . $e->getMessage() . "</li>";
      }
    }
	echo "</div>";

    $tablesResult->close();
}


if (isset($_GET['db'])) {
  $db = $_GET['db'];
  displayPopularCharsForAllTables($conn, $db);
}

$conn->close();
?>

</body>
</html>
