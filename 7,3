<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Браузер Баз Данных</title>
<style>
body {
    font-family: Arial, sans-serif;
    margin: 20px;
}
h1 {
    color: #4CAF50;
}
table {
    width: 100%;
    border-collapse: collapse;
    overflow-x: auto; /* Добавлена для горизонтальной прокрутки */
}
table, th, td {
    border: 1px solid #ddd;
    padding: 8px;
}
th {
    background-color: #f2f2f2;
}
a {
    color: #337ab7;
    text-decoration: none;
}
a:hover {
    text-decoration: underline;
}
.error {
    color: red;
    font-style: italic;
    margin: 10px;
}
.popular-chars {
    margin-bottom: 20px;
}

</style>
</head>
<body>

<h1>Браузер Баз Данных</h1>

<?php
// Конфигурация базы данных (замените на ваши данные)
$host = 'localhost';
$user = 'your_username';
$password = 'your_password';


// Соединение с сервером MySQL
$conn = new mysqli($host, $user, $password);

// Проверка соединения
if ($conn->connect_error) {
    die("<div class='error'>Ошибка подключения: " . $conn->connect_error . "</div>");
}

function displayPopularChars($conn, $table) {
    $popularChars = [];
    $sql = "SHOW COLUMNS FROM $table";
    $result = $conn->query($sql);

	if (!$result) {
		echo "<p class='error'>Ошибка получения структуры таблицы '$table': " . $conn->error . "</p>";
		return;
	}
	
	
    while ($column = $result->fetch_assoc()) {
        $columnName = $column['Field'];
        $sql = "SELECT SUBSTRING(?, 1, 1) AS first_char FROM `$table` WHERE LENGTH(?) > 0 GROUP BY first_char ORDER BY COUNT(*) DESC LIMIT 1";
        $stmt = $conn->prepare($sql);
        $stmt->bind_param("ss", $columnName, $columnName);

        $stmt->execute();
        $result2 = $stmt->get_result();

		if (!$result2) {
			echo "<p class='error'>Ошибка при получении популярного символа для столбца '$columnName' в таблице '$table': " . $conn->error . "</p>";
			$stmt->close();
            return;
        }

        if ($result2->num_rows > 0) {
            $row = $result2->fetch_assoc();
            $popularChars[$columnName] = $row['first_char'];
        } else {
            $popularChars[$columnName] = '<i>Не найдено символов</i>';
        }
		$stmt->close();
        $result2->close();

    }
    $result->close();
	
	echo "<div class='popular-chars'>";
	echo "<table style='width:100%;'>";
	echo "<tr><th>Столбец</th><th>Популярный символ</th></tr>";
	foreach ($popularChars as $column => $char) {
		echo "<tr><td>$column</td><td>$char</td></tr>";
	}
	echo "</table>";
	echo "</div>";
}



function displayPopularCharsForAllTables($conn, $db) {

	echo "<div class='popular-chars'>";
    echo "<h2>Популярные символы во всех таблицах базы данных: $db</h2>";

    echo "<table style='width:100%;'>"; // стиль для 100% ширины
	echo "<tr><th>Таблица</th><th>Столбец</th><th>Популярный символ</th></tr>";


    $result = $conn->query("SHOW TABLES FROM $db");
    if (!$result) {
		echo "<p class='error'>Ошибка при получении списка таблиц: " . $conn->error . "</p>";
		return;
	}
	
	while ($table = $result->fetch_row()) {
        $tableName = $table[0];
        displayPopularChars($conn, $tableName);
    }
	echo "</table>";
	echo "</div>";
}



if (isset($_GET['db'])) {
    $db = $_GET['db'];
    displayPopularCharsForAllTables($conn, $db);
}



$conn->close();
?>

</body>
</html>
